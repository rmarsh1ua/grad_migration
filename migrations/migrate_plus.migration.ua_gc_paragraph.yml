id: ua_gc_paragraph
label: Test paragraph
migration_group: gc_migration
migration_tags:
  - Quickstart Content Migration
status: true

source:
  plugin: d7_node
  node_type:
    - uagc_page
    - accordion_page
    - uagc_admin_page
    - uagc_umbrella_page

process:
  destination_bundle:
    plugin: text_format_recognizer
    format: 'az_standard'
    source: body
    required_module: 'az_paragraphs_html'
    passed: 'az_text'
    failed: 'az_html'
    module_missing: 'az_text'

  type:
    -
      plugin: array_shift
      source: '@destination_bundle'
    -
      plugin: default_value
      default_value: 'az_text'

  temp_fixed_body:
    -
      plugin: str_replace
      regex: true
      source: body
      search: '#a href=\"\/[A-z]+\/sites\/default\/files\/(.+)\"#'
      replace: 'a href="sites/default/files/$1"'

  temp_fixed_body_p2:
    -
      plugin: str_replace
      regex: true
      source: '@temp_fixed_body'
      search: '#img(.+)src=\"\/[A-z]+\/sites\/default\/files\/(.+)\"#'
      replace: 'img$1src="sites/default/files/$2"'

  field_az_full_html:

    plugin: sub_process
    source: '@temp_fixed_body_p2'
    process:
      delta: delta
      value: value
      format:
        plugin: default_value
        default_value: full_html


  body:
    plugin: sub_process
    source: '@temp_fixed_body_p2'
    process:
      delta: delta
      value: value
      format:
        plugin: default_value
        default_value: full_html

  field_az_text_area:
    plugin: sub_process
    source: '@temp_fixed_body_p2'
    process:
      delta: delta
      value: value
      format:
        plugin: default_value
        default_value: az_standard


destination:
  plugin: 'entity_reference_revisions:paragraph'

dependencies:
  enforced:
    module:
      - az_migration
